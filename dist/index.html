<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

    <!-- Figma Plugin DS Styles -->
    <style>
    .text {
      font-size: var(--font-size-xsmall);
      font-weight: var(--font-weight-normal);
      letter-spacing: var(--font-letter-spacing-pos-xsmall);
      line-height: var(--line-height);
      color: var(--black);
      padding: 0; }

    </style>
    <!-- Your Styles -->
  </head>

  <body>
    <div class="p-xxsmall">
      <!-- Input -->
      <div class="label">Components Name</div>
      <div class="input mb-xxsmall">
        <input id="count" type="input" class="input__field" value="Rectangle" />
      </div>

      <!-- Buttons -->
      <div class="flex mb-xxsmall">
        <button id="findNodesButton" class="button button--primary">
          Search
        </button>
      </div>

      <!-- Search Result -->
      <div class="type ml-xxsmall mb-xsmall">
        <p class="type--medium type--bold">Search Result</p>
        <div class="flex">
          <button id="selectAll" class="button button--primary">
            Select All
          </button>
        </div>
      </div>

      <!-- Test -->
      Test

      <!-- Result -->
      <div id="searchResultLayout" class="ml-xxsmall">0 Results Found</div>
    </div>

    <script>
    const findNodesButton = document.querySelector("#findNodesButton");
    const shapeMenu = document.querySelector("#shape");
    const countInput = document.querySelector("#count");
    const selectAll = document.querySelector("#selectAll");

    let selectedNodes = [];

    document.addEventListener("DOMContentLoaded", function () {
      selectMenu.init();
      disclosure.init();
    });

    document.body.addEventListener("click", function (event) {
      if (event.target.type == "checkbox") {
        selectNode(event.target.id);
      }
    });

    findNodesButton.onclick = () => {
      findNodes();
    };

    selectAll.onclick = () => {
      console.log("SELECT!");
    };

    const selectNode = (value) => {
      parent.postMessage(
        {
          pluginMessage: {
            type: "selectNode",
            value: value,
          },
        },
        "*"
      );
    };

    // Posting messages to Main
    const findNodes = () => {
      parent.postMessage(
        {
          pluginMessage: {
            type: "find-all",
            value: countInput.value,
          },
        },
        "*"
      );
    };

    // On receiving messages from Main
    onmessage = (event) => {
      const mainMessage = event.data.pluginMessage;

      if (mainMessage.messageType == "search") {
        let data = mainMessage.data;
        let nodeList = [];

        // Add search result list
        for (i = 0; i < data.length; i++) {
          let message = `
            <div class="checkbox">
              <input id="${data[i].id}" type="checkbox" class="checkbox__box">
              <label for="${data[i].id}" class="checkbox__label">${data[i].name}</label>
            </div>
          `;

          nodeList.push(message);
        }

        // Change the html layout
        document.getElementById("searchResultLayout").innerHTML = nodeList.join("");
      }
    };

    </script>
  </body>
</html>
